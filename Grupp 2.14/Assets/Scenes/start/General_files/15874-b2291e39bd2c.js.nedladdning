"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([[15874],{15874:(e,t,r)=>{r.d(t,{Ay:()=>C,BH:()=>x,EI:()=>N,GY:()=>V,KB:()=>IndentContext,Oh:()=>T,Q0:()=>f,Q_:()=>en,SG:()=>er,TM:()=>Language,Tg:()=>StreamLanguage,WD:()=>M,Xt:()=>w,Yy:()=>LanguageSupport,_Y:()=>I,_v:()=>A,b_:()=>L,bj:()=>LRLanguage,cr:()=>HighlightStyle,iB:()=>h,jU:()=>eo,mv:()=>c,mz:()=>B,nq:()=>ParseContext,p9:()=>u,t:()=>O,t$:()=>LanguageDescription,tp:()=>v,y9:()=>$,yd:()=>R});var n,s=r(90365),i=r(53839),o=r(24774),l=r(43720),a=r(97417);let h=new s.uY;function u(e){return i.sj.define({combine:e?t=>t.concat(e):void 0})}let f=new s.uY;let Language=class Language{constructor(e,t,r=[],n=""){this.data=e,this.name=n,i.$t.prototype.hasOwnProperty("tree")||Object.defineProperty(i.$t.prototype,"tree",{get(){return c(this)}}),this.parser=t,this.extension=[x.of(this),i.$t.languageData.of((e,t,r)=>{let n=d(e,t,r),s=n.type.prop(h);if(!s)return[];let i=e.facet(s),o=n.type.prop(f);if(o){let s=n.resolve(t-n.from,r);for(let t of o)if(t.test(s,e)){let r=e.facet(t.facet);return"replace"==t.type?r:r.concat(i)}}return i})].concat(r)}isActiveAt(e,t,r=-1){return d(e,t,r).type.prop(h)==this.data}findRegions(e){let t=e.facet(x);if((null==t?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(e,t)=>{if(e.prop(h)==this.data)return void r.push({from:t,to:t+e.length});let i=e.prop(s.uY.mounted);if(i){if(i.tree.prop(h)==this.data){if(i.overlay)for(let e of i.overlay)r.push({from:e.from+t,to:e.to+t});else r.push({from:t,to:t+e.length});return}else if(i.overlay){let e=r.length;if(n(i.tree,i.overlay[0].from+t),r.length>e)return}}for(let r=0;r<e.children.length;r++){let i=e.children[r];i instanceof s.PH&&n(i,e.positions[r]+t)}};return n(c(e),0),r}get allowsNesting(){return!0}};function d(e,t,r){let n=e.facet(x),i=c(e).topNode;if(!n||n.allowsNesting)for(let e=i;e;e=e.enter(t,r,s.Qj.ExcludeBuffers))e.type.isTop&&(i=e);return i}Language.setState=i.Pe.define();let LRLanguage=class LRLanguage extends Language{constructor(e,t,r){super(e,t,[],r),this.parser=t}static define(e){let t=u(e.languageData);return new LRLanguage(t,e.parser.configure({props:[h.add(e=>e.isTop?t:void 0)]}),e.name)}configure(e,t){return new LRLanguage(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}};function c(e){let t=e.field(Language.state,!1);return t?t.tree:s.PH.empty}let DocInput=class DocInput{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}};let p=null;let ParseContext=class ParseContext{constructor(e,t,r=[],n,s,i,o,l){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=s,this.viewport=i,this.skipped=o,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new ParseContext(e,t,[],s.PH.empty,0,r,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,t){return(null!=t&&t>=this.state.doc.length&&(t=void 0),this.tree!=s.PH.empty&&this.isDone(null!=t?t:this.state.doc.length))?(this.takeTree(),!0):this.withContext(()=>{var r;if("number"==typeof e){let t=Date.now()+e;e=()=>Date.now()>t}for(this.parse||(this.parse=this.startParse()),null!=t&&(null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n){if(this.fragments=this.withoutTempSkipped(s.rr.addTree(n,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!=(r=this.parse.stoppedAt)?r:this.state.doc.length,this.tree=n,this.parse=null,!(this.treeLen<(null!=t?t:this.state.doc.length)))return!0;this.parse=this.startParse()}if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(s.rr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=p;p=this;try{return e()}finally{p=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=g(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:i,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let t=[];if(e.iterChangedRanges((e,r,n,s)=>t.push({fromA:e,toA:r,fromB:n,toB:s})),r=s.rr.applyChanges(r,t),n=s.PH.empty,i=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length)for(let t of(l=[],this.skipped)){let r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);r<n&&l.push({from:r,to:n})}}return new ParseContext(this.parser,t,r,n,i,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let t=0;t<this.skipped.length;t++){let{from:r,to:n}=this.skipped[t];r<e.to&&n>e.from&&(this.fragments=g(this.fragments,r,n),this.skipped.splice(t--,1))}return!(this.skipped.length>=t)&&(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends s.iX{createParse(t,r,n){let i=n[0].from,o=n[n.length-1].to;return{parsedPos:i,advance(){let t=p;if(t){for(let e of n)t.tempSkipped.push(e);e&&(t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e)}return this.parsedPos=o,new s.PH(s.Z6.none,[],[],o-i)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&0==t[0].from&&t[0].to>=e}static get(){return p}};function g(e,t,r){return s.rr.applyChanges(e,[{fromA:t,toA:r,fromB:t,toB:r}])}let LanguageState=class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new LanguageState(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=ParseContext.create(e.facet(x).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new LanguageState(r)}};Language.state=i.sU.define({create:LanguageState.init,update(e,t){for(let e of t.effects)if(e.is(Language.setState))return e.value;return t.startState.facet(x)!=t.state.facet(x)?LanguageState.init(t.state):e.apply(t)}});let m=e=>{let t=setTimeout(()=>e(),500);return()=>clearTimeout(t)};"undefined"!=typeof requestIdleCallback&&(m=e=>{let t=-1,r=setTimeout(()=>{t=requestIdleCallback(e,{timeout:400})},100);return()=>t<0?clearTimeout(r):cancelIdleCallback(t)});let y="undefined"!=typeof navigator&&(null==(n=navigator.scheduling)?void 0:n.isInputPending)?()=>navigator.scheduling.isInputPending():null,b=o.Z9.fromClass(class ParseWorker{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Language.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Language.state);t.tree==t.context.tree&&t.context.isDone(e.doc.length)||(this.working=m(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,s=r.field(Language.state);if(s.tree==s.context.tree&&s.context.isDone(n+1e5))return;let i=Date.now()+Math.min(this.chunkBudget,100,e&&!y?Math.max(25,e.timeRemaining()-5):1e9),o=s.context.treeLen<n&&r.doc.length>n+1e3,l=s.context.work(()=>y&&y()||Date.now()>i,n+1e5*!o);this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(s.context))})),this.chunkBudget>0&&!(l&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(e=>(0,o.c_)(this.view.state,e)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),x=i.sj.define({combine:e=>e.length?e[0]:null,enables:e=>[Language.state,b,o.Lz.contentAttributes.compute([e],t=>{let r=t.facet(e);return r&&r.name?{"data-language":r.name}:{}})]});let LanguageSupport=class LanguageSupport{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}};let LanguageDescription=class LanguageDescription{constructor(e,t,r,n,s,i){this.name=e,this.alias=t,this.extensions=r,this.filename=n,this.loadFunc=s,this.support=i,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(e=>this.support=e,e=>{throw this.loading=null,e}))}static of(e){let{load:t,support:r}=e;if(!t){if(!r)throw RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");t=()=>Promise.resolve(r)}return new LanguageDescription(e.name,(e.alias||[]).concat(e.name).map(e=>e.toLowerCase()),e.extensions||[],e.filename,t,r)}static matchFilename(e,t){for(let r of e)if(r.filename&&r.filename.test(t))return r;let r=/\.([^.]+)$/.exec(t);if(r){for(let t of e)if(t.extensions.indexOf(r[1])>-1)return t}return null}static matchLanguageName(e,t,r=!0){for(let r of(t=t.toLowerCase(),e))if(r.alias.some(e=>e==t))return r;if(r)for(let r of e)for(let e of r.alias){let n=t.indexOf(e);if(n>-1&&(e.length>2||!/\w/.test(t[n-1])&&!/\w/.test(t[n+e.length])))return r}return null}};let k=i.sj.define(),w=i.sj.define({combine:e=>{if(!e.length)return"  ";let t=e[0];if(!t||/\S/.test(t)||Array.from(t).some(e=>e!=t[0]))throw Error("Invalid indent unit: "+JSON.stringify(e[0]));return t}});function v(e){let t=e.facet(w);return 9==t.charCodeAt(0)?e.tabSize*t.length:t.length}function N(e,t){let r="",n=e.tabSize,s=e.facet(w)[0];if("	"==s){for(;t>=n;)r+="	",t-=n;s=" "}for(let e=0;e<t;e++)r+=s;return r}function A(e,t){var r,n,s;for(let r of(e instanceof i.$t&&(e=new IndentContext(e)),e.state.facet(k))){let n=r(e,t);if(void 0!==n)return n}let o=c(e.state);return o?(r=e,n=o,s=t,S(n.resolveInner(s).enterUnfinishedNodesBefore(s),s,r)):null}let IndentContext=class IndentContext{constructor(e,t={}){this.state=e,this.options=t,this.unit=v(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:s}=this.options;if(null!=n&&n>=r.from&&n<=r.to)if(s&&n==e)return{text:"",from:e};else if(t<0?n<e:n<=e)return{text:r.text.slice(n-r.from),from:n};else return{text:r.text.slice(0,n-r.from),from:r.from};return r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.countColumn(r,e-n),i=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return i>-1&&(s+=i-this.countColumn(r,r.search(/\S|$/))),s}countColumn(e,t=e.length){return(0,i.y$)(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let e=s(n);if(e>-1)return e}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}};let T=new s.uY;function S(e,t,r){for(;e;e=e.parent){let n=function(e){let t=e.type.prop(T);if(t)return t;let r=e.firstChild,n;if(r&&(n=r.type.prop(s.uY.closedBy))){let t=e.lastChild,r=t&&n.indexOf(t.name)>-1;return e=>_(e,!0,1,void 0,r&&!(e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak)?t.from:void 0)}return null==e.parent?P:null}(e);if(n)return n(TreeIndentContext.create(r,t,e))}return null}function P(){return 0}let TreeIndentContext=class TreeIndentContext extends IndentContext{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.node=r}static create(e,t,r){return new TreeIndentContext(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let t=this.node.resolve(e.from);for(;t.parent&&t.parent.from==t.from;)t=t.parent;if(function(e,t){for(let r=t;r;r=r.parent)if(e==r)return!0;return!1}(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?S(e,this.pos,this.base):0}};function C({closing:e,align:t=!0,units:r=1}){return n=>_(n,t,r,e)}function _(e,t,r,n,s){let i=e.textAfter,o=i.match(/^\s*/)[0].length,l=n&&i.slice(o,o+n.length)==n||s==e.pos+o,a=t?function(e){let t=e.node,r=t.childAfter(t.from),n=t.lastChild;if(!r)return null;let s=e.options.simulateBreak,i=e.state.doc.lineAt(r.from),o=null==s||s<=i.from?i.to:Math.min(i.to,s);for(let e=r.to;;){let s=t.childAfter(e);if(!s||s==n)return null;if(!s.type.isSkipped)return s.from<o?r:null;e=s.to}}(e):null;return a?l?e.column(a.from):e.column(a.to):e.baseIndent+(l?0:e.unit*r)}let I=e=>e.baseIndent;function B({except:e,units:t=1}={}){return r=>{let n=e&&e.test(r.textAfter);return r.baseIndent+(n?0:t*r.unit)}}function M(){return i.$t.transactionFilter.of(e=>{if(!e.docChanged||!e.isUserEvent("input.type")&&!e.isUserEvent("input.complete"))return e;let t=e.startState.languageDataAt("indentOnInput",e.startState.selection.main.head);if(!t.length)return e;let r=e.newDoc,{head:n}=e.newSelection.main,s=r.lineAt(n);if(n>s.from+200)return e;let i=r.sliceString(s.from,n);if(!t.some(e=>e.test(i)))return e;let{state:o}=e,l=-1,a=[];for(let{head:e}of o.selection.ranges){let t=o.doc.lineAt(e);if(t.from==l)continue;l=t.from;let r=A(o,t.from);if(null==r)continue;let n=/^\s*/.exec(t.text)[0],s=N(o,r);n!=s&&a.push({from:t.from,to:t.from+n.length,insert:s})}return a.length?[e,{changes:a,sequential:!0}]:e})}let O=i.sj.define(),L=new s.uY;function R(e){let t=e.firstChild,r=e.lastChild;return t&&t.to<r.from?{from:t.to,to:r.type.isError?e.to:r.from}:null}function D(e,t){let r=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return r>=n?void 0:{from:r,to:n}}let E=i.Pe.define({map:D}),z=i.Pe.define({map:D}),j=i.sU.define({create:()=>o.NZ.none,update(e,t){for(let r of(e=e.map(t.changes),t.effects))r.is(E)&&!function(e,t,r){let n=!1;return e.between(t,t,(e,s)=>{e==t&&s==r&&(n=!0)}),n}(e,r.value.from,r.value.to)?e=e.update({add:[W.range(r.value.from,r.value.to)]}):r.is(z)&&(e=e.update({filter:(e,t)=>r.value.from!=e||r.value.to!=t,filterFrom:r.value.from,filterTo:r.value.to}));if(t.selection){let r=!1,{head:n}=t.selection.main;e.between(n,n,(e,t)=>{e<n&&t>n&&(r=!0)}),r&&(e=e.update({filterFrom:n,filterTo:n,filter:(e,t)=>t<=n||e>=n}))}return e},provide:e=>o.Lz.decorations.from(e),toJSON(e,t){let r=[];return e.between(0,t.doc.length,(e,t)=>{r.push(e,t)}),r},fromJSON(e){if(!Array.isArray(e)||e.length%2)throw RangeError("Invalid JSON for fold state");let t=[];for(let r=0;r<e.length;){let n=e[r++],s=e[r++];if("number"!=typeof n||"number"!=typeof s)throw RangeError("Invalid JSON for fold state");t.push(W.range(n,s))}return o.NZ.set(t,!0)}}),F={placeholderDOM:null,placeholderText:"\u2026"},H=i.sj.define({combine:e=>(0,i.QR)(e,F)}),W=o.NZ.replace({widget:new class extends o.xO{toDOM(e){let{state:t}=e,r=t.facet(H),n=t=>{var r,n,s,i;let o,l=e.lineBlockAt(e.posAtDOM(t.target)),a=(r=e.state,n=l.from,s=l.to,o=null,null==(i=r.field(j,!1))||i.between(n,s,(e,t)=>{(!o||o.from>e)&&(o={from:e,to:t})}),o);a&&e.dispatch({effects:z.of(a)}),t.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(e,n);let s=document.createElement("span");return s.textContent=r.placeholderText,s.setAttribute("aria-label",t.phrase("folded code")),s.title=t.phrase("unfold"),s.className="cm-foldPlaceholder",s.onclick=n,s}}});o.wJ;let HighlightStyle=class HighlightStyle{constructor(e,t){let r;function n(e){let t=a.G.newName();return(r||(r=Object.create(null)))["."+t]=e,t}this.specs=e;const s="string"==typeof t.all?t.all:t.all?n(t.all):void 0,i=t.scope;this.scope=i instanceof Language?e=>e.prop(h)==i.data:i?e=>e==i:void 0,this.style=(0,l.az)(e.map(e=>({tag:e.tag,class:e.class||n(Object.assign({},e,{tag:null}))})),{all:s}).style,this.module=r?new a.G(r):null,this.themeType=t.themeType}static define(e,t){return new HighlightStyle(e,t||{})}};let U=i.sj.define(),Y=i.sj.define({combine:e=>e.length?[e[0]]:null});function Z(e){let t=e.facet(U);return t.length?t:e.facet(Y)}function $(e,t){let r=[J],n;return e instanceof HighlightStyle&&(e.module&&r.push(o.Lz.styleModule.of(e.module)),n=e.themeType),(null==t?void 0:t.fallback)?r.push(Y.of(e)):n?r.push(U.computeN([o.Lz.darkTheme],t=>t.facet(o.Lz.darkTheme)==("dark"==n)?[e]:[])):r.push(U.of(e)),r}function V(e,t,r){let n=Z(e),s=null;if(n){for(let e of n)if(!e.scope||r&&e.scope(r)){let r=e.style(t);r&&(s=s?s+" "+r:r)}}return s}let TreeHighlighter=class TreeHighlighter{constructor(e){this.markCache=Object.create(null),this.tree=c(e.state),this.decorations=this.buildDeco(e,Z(e.state))}update(e){let t=c(e.state),r=Z(e.state),n=r!=Z(e.startState);t.length<e.view.viewport.to&&!n&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r))}buildDeco(e,t){if(!t||!this.tree.length)return o.NZ.none;let r=new i.vB;for(let{from:n,to:s}of e.visibleRanges)(0,l.DM)(this.tree,t,(e,t,n)=>{r.add(e,t,this.markCache[n]||(this.markCache[n]=o.NZ.mark({class:n})))},n,s);return r.finish()}};let J=i.Nb.high(o.Z9.fromClass(TreeHighlighter,{decorations:e=>e.decorations}));l._A.meta,l._A.link,l._A.heading,l._A.emphasis,l._A.strong,l._A.strikethrough,l._A.keyword,l._A.atom,l._A.bool,l._A.url,l._A.contentSeparator,l._A.labelName,l._A.literal,l._A.inserted,l._A.string,l._A.deleted,l._A.regexp,l._A.escape,l._A.string,l._A.variableName,l._A.variableName,l._A.typeName,l._A.namespace,l._A.className,l._A.variableName,l._A.macroName,l._A.propertyName,l._A.comment,l._A.invalid;let q=o.Lz.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),G="()[]{}",Q=i.sj.define({combine:e=>(0,i.QR)(e,{afterCursor:!0,brackets:G,maxScanDistance:1e4,renderMatch:ee})}),K=o.NZ.mark({class:"cm-matchingBracket"}),X=o.NZ.mark({class:"cm-nonmatchingBracket"});function ee(e){let t=[],r=e.matched?K:X;return t.push(r.range(e.start.from,e.start.to)),e.end&&t.push(r.range(e.end.from,e.end.to)),t}let et=[i.sU.define({create:()=>o.NZ.none,update(e,t){if(!t.docChanged&&!t.selection)return e;let r=[],n=t.state.facet(Q);for(let e of t.state.selection.ranges){if(!e.empty)continue;let s=eo(t.state,e.head,-1,n)||e.head>0&&eo(t.state,e.head-1,1,n)||n.afterCursor&&(eo(t.state,e.head,1,n)||e.head<t.state.doc.length&&eo(t.state,e.head+1,-1,n));s&&(r=r.concat(n.renderMatch(s,t.state)))}return o.NZ.set(r,!0)},provide:e=>o.Lz.decorations.from(e)}),q];function er(e={}){return[Q.of(e),et]}let en=new s.uY;function es(e,t,r){let n=e.prop(t<0?s.uY.openedBy:s.uY.closedBy);if(n)return n;if(1==e.name.length){let n=r.indexOf(e.name);if(n>-1&&n%2==+(t<0))return[r[n+t]]}return null}function ei(e){let t=e.type.prop(en);return t?t(e.node):e}function eo(e,t,r,n={}){let s=n.maxScanDistance||1e4,i=n.brackets||G,o=c(e),l=o.resolveInner(t,r);for(let e=l;e;e=e.parent){let n=es(e.type,r,i);if(n&&e.from<e.to){let s=ei(e);if(s&&(r>0?t>=s.from&&t<s.to:t>s.from&&t<=s.to))return function(e,t,r,n,s,i,o){let l=n.parent,a={from:s.from,to:s.to},h=0,u=null==l?void 0:l.cursor();if(u&&(r<0?u.childBefore(n.from):u.childAfter(n.to)))do if(r<0?u.to<=n.from:u.from>=n.to){if(0==h&&i.indexOf(u.type.name)>-1&&u.from<u.to){let e=ei(u);return{start:a,end:e?{from:e.from,to:e.to}:void 0,matched:!0}}else if(es(u.type,r,o))h++;else if(es(u.type,-r,o)){if(0==h){let e=ei(u);return{start:a,end:e&&e.from<e.to?{from:e.from,to:e.to}:void 0,matched:!1}}h--}}while(r<0?u.prevSibling():u.nextSibling())return{start:a,matched:!1}}(0,0,r,e,s,n,i)}}return function(e,t,r,n,s,i,o){let l=r<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1),a=o.indexOf(l);if(a<0||a%2==0!=r>0)return null;let h={from:r<0?t-1:t,to:r>0?t+1:t},u=e.doc.iterRange(t,r>0?e.doc.length:0),f=0;for(let e=0;!u.next().done&&e<=i;){let i=u.value;r<0&&(e+=i.length);let l=t+e*r;for(let e=r>0?0:i.length-1,t=r>0?i.length:-1;e!=t;e+=r){let t=o.indexOf(i[e]);if(!(t<0)&&n.resolveInner(l+e,1).type==s)if(t%2==0==r>0)f++;else{if(1==f)return{start:h,end:{from:l+e,to:l+e+1},matched:t>>1==a>>1};f--}}r>0&&(e+=i.length)}return u.done?{start:h,matched:!1}:null}(e,t,r,o,l.type,s,i)}function el(e,t,r,n=0,s=0){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);let i=s;for(let s=n;s<t;s++)9==e.charCodeAt(s)?i+=r-i%r:i++;return i}let StringStream=class StringStream{constructor(e,t,r,n){this.string=e,this.tabSize=t,this.indentUnit=r,this.overrideIndent=n,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e instanceof RegExp?e.test(t):e(t)))return++this.pos,t}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=el(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return null!=(e=this.overrideIndent)?e:el(this.string,null,this.tabSize)}match(e,t,r){if("string"==typeof e){let n=e=>r?e.toLowerCase():e;return n(this.string.substr(this.pos,e.length))==n(e)?(!1!==t&&(this.pos+=e.length),!0):null}{let r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&!1!==t&&(this.pos+=r[0].length),r)}}current(){return this.string.slice(this.start,this.pos)}};function ea(e){if("object"!=typeof e)return e;let t={};for(let r in e){let n=e[r];t[r]=n instanceof Array?n.slice():n}return t}let eh=new WeakMap;let StreamLanguage=class StreamLanguage extends Language{constructor(e){let t=u(e.languageData),r=function(e){return{name:e.name||"",token:e.token,blankLine:e.blankLine||(()=>{}),startState:e.startState||(()=>!0),copyState:e.copyState||ea,indent:e.indent||(()=>null),languageData:e.languageData||{},tokenTable:e.tokenTable||ed}}(e),n;super(t,new class extends s.iX{createParse(e,t,r){return new Parse(n,e,t,r)}},[k.of((e,t)=>this.getIndent(e,t))],e.name),this.topNode=function(e){let t=s.Z6.define({id:ec.length,name:"Document",props:[h.add(()=>e)]});return ec.push(t),t}(t),n=this,this.streamParser=r,this.stateAfter=new s.uY({perNode:!0}),this.tokenTable=e.tokenTable?new TokenTable(r.tokenTable):ey}static define(e){return new StreamLanguage(e)}getIndent(e,t){let r,n=c(e.state),s=n.resolve(t);for(;s&&s.type!=this.topNode;)s=s.parent;if(!s)return null;let{overrideIndentation:i}=e.options;i&&null!=(r=eh.get(e.state))&&r<t-1e4&&(r=void 0);let o=eu(this,n,0,s.from,null!=r?r:t),l,a;if(o?(a=o.state,l=o.pos+1):(a=this.streamParser.startState(e.unit),l=0),t-l>1e4)return null;for(;l<t;){let r=e.state.doc.lineAt(l),n=Math.min(t,r.to);if(r.length){let t=i?i(r.from):-1,s=new StringStream(r.text,e.state.tabSize,e.unit,t<0?void 0:t);for(;s.pos<n-r.from;)ef(this.streamParser.token,s,a)}else this.streamParser.blankLine(a,e.unit);if(n==t)break;l=r.to+1}let h=e.lineAt(t);return i&&null==r&&eh.set(e.state,h.from),this.streamParser.indent(a,/^\s*(.*)/.exec(h.text)[1],e)}get allowsNesting(){return!1}};function eu(e,t,r,n,i){let o=r>=n&&r+t.length<=i&&t.prop(e.stateAfter);if(o)return{state:e.streamParser.copyState(o),pos:r+t.length};for(let o=t.children.length-1;o>=0;o--){let l=t.children[o],a=r+t.positions[o],h=l instanceof s.PH&&a<i&&eu(e,l,a,n,i);if(h)return h}return null}let Parse=class Parse{constructor(e,t,r,n){this.lang=e,this.input=t,this.fragments=r,this.ranges=n,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=n[n.length-1].to;let i=ParseContext.get(),o=n[0].from,{state:l,tree:a}=function(e,t,r,n){for(let n of t){let t=n.from+25*!!n.openStart,i=n.to-25*!!n.openEnd,o=t<=r&&i>r&&eu(e,n.tree,0-n.offset,r,i),l;if(o&&(l=function e(t,r,n,i,o){if(o&&n<=0&&i>=r.length)return r;o||r.type!=t.topNode||(o=!0);for(let l=r.children.length-1;l>=0;l--){let a=r.positions[l],h=r.children[l],u;if(a<i&&h instanceof s.PH){if(!(u=e(t,h,n-a,i-a,o)))break;return o?new s.PH(r.type,r.children.slice(0,l).concat(u),r.positions.slice(0,l+1),a+u.length):u}}return null}(e,n.tree,r+n.offset,o.pos+n.offset,!1)))return{state:o.state,tree:l}}return{state:e.streamParser.startState(n?v(n):4),tree:s.PH.empty}}(e,r,o,null==i?void 0:i.state);this.state=l,this.parsedPos=this.chunkStart=o+a.length;for(let e=0;e<a.children.length;e++)this.chunks.push(a.children[e]),this.chunkPos.push(a.positions[e]);i&&this.parsedPos<i.viewport.from-1e5&&(this.state=this.lang.streamParser.startState(v(i.state)),i.skipUntilInView(this.parsedPos,i.viewport.from),this.parsedPos=i.viewport.from),this.moveRangeIndex()}advance(){let e=ParseContext.get(),t=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(t,this.chunkStart+2048);for(e&&(r=Math.min(r,e.viewport.to));this.parsedPos<r;)this.parseLine(e);return(this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=t)?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,t),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let t=this.input.chunk(e);if(this.input.lineChunks)`
`==t&&(t="");else{let e=t.indexOf(`
`);e>-1&&(t=t.slice(0,e))}return e+t.length<=this.to?t:t.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,t=this.lineAfter(e),r=e+t.length;for(let e=this.rangeIndex;;){let n=this.ranges[e].to;if(n>=r||(t=t.slice(0,n-(r-t.length)),++e==this.ranges.length))break;let s=this.ranges[e].from,i=this.lineAfter(s);t+=i,r=s+i.length}return{line:t,end:r}}skipGapsTo(e,t,r){for(;;){let n=this.ranges[this.rangeIndex].to,s=e+t;if(r>0?n>s:n>=s)break;let i=this.ranges[++this.rangeIndex].from;t+=i-n}return t}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,t,r,n,s){if(this.ranges.length>1){s=this.skipGapsTo(t,s,1),t+=s;let e=this.chunk.length;s=this.skipGapsTo(r,s,-1),r+=s,n+=this.chunk.length-e}return this.chunk.push(e,t,r,n),s}parseLine(e){let{line:t,end:r}=this.nextLine(),n=0,{streamParser:s}=this.lang,i=new StringStream(t,e?e.state.tabSize:4,e?v(e.state):2);if(i.eol())s.blankLine(this.state,i.indentUnit);else for(;!i.eol();){let e=ef(s.token,i,this.state);if(e&&(n=this.emitToken(this.lang.tokenTable.resolve(e),this.parsedPos+i.start,this.parsedPos+i.pos,4,n)),i.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=s.PH.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:ep,topID:0,maxBufferLength:2048,reused:this.chunkReused});e=new s.PH(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new s.PH(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}};function ef(e,t,r){t.start=t.pos;for(let n=0;n<10;n++){let n=e(t,r);if(t.pos>t.start)return n}throw Error("Stream parser failed to advance stream.")}let ed=Object.create(null),ec=[s.Z6.none],ep=new s.fI(ec),eg=[],em=Object.create(null);for(let[e,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])em[e]=ex(ed,t);let TokenTable=class TokenTable{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),em)}resolve(e){return e?this.table[e]||(this.table[e]=ex(this.extra,e)):0}};let ey=new TokenTable(ed);function eb(e,t){eg.indexOf(e)>-1||(eg.push(e),console.warn(t))}function ex(e,t){let r=null;for(let n of t.split(".")){let t=e[n]||l._A[n];t?"function"==typeof t?r?r=t(r):eb(n,`Modifier ${n} used at start of tag`):r?eb(n,`Tag ${n} used as modifier`):r=t:eb(n,`Unknown highlighting tag ${n}`)}if(!r)return 0;let n=t.replace(/ /g,"_"),i=s.Z6.define({id:ec.length,name:n,props:[(0,l.pn)({[n]:r})]});return ec.push(i),i.id}},43720:(e,t,r)=>{r.d(t,{DM:()=>h,_A:()=>T,az:()=>a,pn:()=>o,vw:()=>Tag});var n=r(90365);let s=0;let Tag=class Tag{constructor(e,t,r){this.set=e,this.base=t,this.modified=r,this.id=s++}static define(e){if(null==e?void 0:e.base)throw Error("Can not derive from a modified tag");let t=new Tag([],null,[]);if(t.set.push(t),e)for(let r of e.set)t.set.push(r);return t}static defineModifier(){let e=new Modifier;return t=>t.modified.indexOf(e)>-1?t:Modifier.get(t.base||t,t.modified.concat(e).sort((e,t)=>e.id-t.id))}};let i=0;let Modifier=class Modifier{constructor(){this.instances=[],this.id=i++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(r=>{var n,s;return r.base==e&&(n=t,s=r.modified,n.length==s.length&&n.every((e,t)=>e==s[t]))});if(r)return r;let n=[],s=new Tag(n,e,t);for(let e of t)e.instances.push(s);let i=function(e){let t=[[]];for(let r=0;r<e.length;r++)for(let n=0,s=t.length;n<s;n++)t.push(t[n].concat(e[r]));return t.sort((e,t)=>t.length-e.length)}(t);for(let t of e.set)if(!t.modified.length)for(let e of i)n.push(Modifier.get(t,e));return s}};function o(e){let t=Object.create(null);for(let r in e){let n=e[r];for(let e of(Array.isArray(n)||(n=[n]),r.split(" ")))if(e){let r=[],s=2,i=e;for(let t=0;;){if("..."==i&&t>0&&t+3==e.length){s=1;break}let n=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(i);if(!n)throw RangeError("Invalid path: "+e);if(r.push("*"==n[0]?"":'"'==n[0][0]?JSON.parse(n[0]):n[0]),(t+=n[0].length)==e.length)break;let o=e[t++];if(t==e.length&&"!"==o){s=0;break}if("/"!=o)throw RangeError("Invalid path: "+e);i=e.slice(t)}let o=r.length-1,l=r[o];if(!l)throw RangeError("Invalid path: "+e);let a=new Rule(n,s,o>0?r.slice(0,o):null);t[l]=a.sort(t[l])}}return l.add(t)}let l=new n.uY;let Rule=class Rule{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return 0==this.mode}get inherit(){return 1==this.mode}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}};function a(e,t){let r=Object.create(null);for(let t of e)if(Array.isArray(t.tag))for(let e of t.tag)r[e.id]=t.class;else r[t.tag.id]=t.class;let{scope:n,all:s=null}=t||{};return{style:e=>{let t=s;for(let n of e)for(let e of n.set){let n=r[e.id];if(n){t=t?t+" "+n:n;break}}return t},scope:n}}function h(e,t,r,n=0,s=e.length){let i=new HighlightBuilder(n,Array.isArray(t)?t:[t],r);i.highlightRange(e.cursor(),n,s,"",i.highlighters),i.flush(s)}Rule.empty=new Rule([],2,null);let HighlightBuilder=class HighlightBuilder{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,s,i){let{type:o,from:a,to:h}=e;if(a>=r||h<=t)return;o.isTop&&(i=this.highlighters.filter(e=>!e.scope||e.scope(o)));let u=s,f=function(e){let t=e.type.prop(l);for(;t&&t.context&&!e.matchContext(t.context);)t=t.next;return t||null}(e)||Rule.empty,d=function(e,t){let r=null;for(let n of e){let e=n.style(t);e&&(r=r?r+" "+e:e)}return r}(i,f.tags);if(d&&(u&&(u+=" "),u+=d,1==f.mode&&(s+=(s?" ":"")+d)),this.startSpan(e.from,u),f.opaque)return;let c=e.tree&&e.tree.prop(n.uY.mounted);if(c&&c.overlay){let n=e.node.enter(c.overlay[0].from+a,1),o=this.highlighters.filter(e=>!e.scope||e.scope(c.tree.type)),l=e.firstChild();for(let f=0,d=a;;f++){let p=f<c.overlay.length?c.overlay[f]:null,g=p?p.from+a:h,m=Math.max(t,d),y=Math.min(r,g);if(m<y&&l)for(;e.from<y&&(this.highlightRange(e,m,y,s,i),this.startSpan(Math.min(y,e.to),u),!(e.to>=g)&&e.nextSibling()););if(!p||g>r)break;(d=p.to+a)>t&&(this.highlightRange(n.cursor(),Math.max(t,p.from+a),Math.min(r,d),s,o),this.startSpan(d,u))}l&&e.parent()}else if(e.firstChild()){do{if(e.to<=t)continue;if(e.from>=r)break;this.highlightRange(e,t,r,s,i),this.startSpan(Math.min(r,e.to),u)}while(e.nextSibling())e.parent()}}};let u=Tag.define,f=u(),d=u(),c=u(d),p=u(d),g=u(),m=u(g),y=u(g),b=u(),x=u(b),k=u(),w=u(),v=u(),N=u(v),A=u(),T={comment:f,lineComment:u(f),blockComment:u(f),docComment:u(f),name:d,variableName:u(d),typeName:c,tagName:u(c),propertyName:p,attributeName:u(p),className:u(d),labelName:u(d),namespace:u(d),macroName:u(d),literal:g,string:m,docString:u(m),character:u(m),attributeValue:u(m),number:y,integer:u(y),float:u(y),bool:u(g),regexp:u(g),escape:u(g),color:u(g),url:u(g),keyword:k,self:u(k),null:u(k),atom:u(k),unit:u(k),modifier:u(k),operatorKeyword:u(k),controlKeyword:u(k),definitionKeyword:u(k),moduleKeyword:u(k),operator:w,derefOperator:u(w),arithmeticOperator:u(w),logicOperator:u(w),bitwiseOperator:u(w),compareOperator:u(w),updateOperator:u(w),definitionOperator:u(w),typeOperator:u(w),controlOperator:u(w),punctuation:v,separator:u(v),bracket:N,angleBracket:u(N),squareBracket:u(N),paren:u(N),brace:u(N),content:b,heading:x,heading1:u(x),heading2:u(x),heading3:u(x),heading4:u(x),heading5:u(x),heading6:u(x),contentSeparator:u(b),list:u(b),quote:u(b),emphasis:u(b),strong:u(b),link:u(b),monospace:u(b),strikethrough:u(b),inserted:u(),deleted:u(),changed:u(),invalid:u(),meta:A,documentMeta:u(A),annotation:u(A),processingInstruction:u(A),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};a([{tag:T.link,class:"tok-link"},{tag:T.heading,class:"tok-heading"},{tag:T.emphasis,class:"tok-emphasis"},{tag:T.strong,class:"tok-strong"},{tag:T.keyword,class:"tok-keyword"},{tag:T.atom,class:"tok-atom"},{tag:T.bool,class:"tok-bool"},{tag:T.url,class:"tok-url"},{tag:T.labelName,class:"tok-labelName"},{tag:T.inserted,class:"tok-inserted"},{tag:T.deleted,class:"tok-deleted"},{tag:T.literal,class:"tok-literal"},{tag:T.string,class:"tok-string"},{tag:T.number,class:"tok-number"},{tag:[T.regexp,T.escape,T.special(T.string)],class:"tok-string2"},{tag:T.variableName,class:"tok-variableName"},{tag:T.local(T.variableName),class:"tok-variableName tok-local"},{tag:T.definition(T.variableName),class:"tok-variableName tok-definition"},{tag:T.special(T.variableName),class:"tok-variableName2"},{tag:T.definition(T.propertyName),class:"tok-propertyName tok-definition"},{tag:T.typeName,class:"tok-typeName"},{tag:T.namespace,class:"tok-namespace"},{tag:T.className,class:"tok-className"},{tag:T.macroName,class:"tok-macroName"},{tag:T.propertyName,class:"tok-propertyName"},{tag:T.operator,class:"tok-operator"},{tag:T.comment,class:"tok-comment"},{tag:T.meta,class:"tok-meta"},{tag:T.invalid,class:"tok-invalid"},{tag:T.punctuation,class:"tok-punctuation"}])},90365:(e,t,r)=>{var n,s;r.d(t,{$g:()=>x,PH:()=>Tree,Qj:()=>n,RY:()=>NodeWeakMap,Z6:()=>NodeType,cF:()=>i,fI:()=>NodeSet,iX:()=>Parser,rr:()=>TreeFragment,uY:()=>NodeProp});let i=1024,o=0;let Range=class Range{constructor(e,t){this.from=e,this.to=t}};let NodeProp=class NodeProp{constructor(e={}){this.id=o++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw RangeError("Can't add per-node props to node types");return"function"!=typeof e&&(e=NodeType.match(e)),t=>{let r=e(t);return void 0===r?null:[this,r]}}};NodeProp.closedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.openedBy=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.group=new NodeProp({deserialize:e=>e.split(" ")}),NodeProp.isolate=new NodeProp({deserialize:e=>{if(e&&"rtl"!=e&&"ltr"!=e&&"auto"!=e)throw RangeError("Invalid value for isolate: "+e);return e||"auto"}}),NodeProp.contextHash=new NodeProp({perNode:!0}),NodeProp.lookAhead=new NodeProp({perNode:!0}),NodeProp.mounted=new NodeProp({perNode:!0});let MountedTree=class MountedTree{constructor(e,t,r){this.tree=e,this.overlay=t,this.parser=r}static get(e){return e&&e.props&&e.props[NodeProp.mounted.id]}};let l=Object.create(null);let NodeType=class NodeType{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):l,r=!!e.top|2*!!e.skipped|4*!!e.error|8*(null==e.name),n=new NodeType(e.name||"",t,e.id,r);if(e.props){for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(1&this.flags)>0}get isSkipped(){return(2&this.flags)>0}get isError(){return(4&this.flags)>0}get isAnonymous(){return(8&this.flags)>0}is(e){if("string"==typeof e){if(this.name==e)return!0;let t=this.prop(NodeProp.group);return!!t&&t.indexOf(e)>-1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return e=>{for(let r=e.prop(NodeProp.group),n=-1;n<(r?r.length:0);n++){let s=t[n<0?e.name:r[n]];if(s)return s}}}};NodeType.none=new NodeType("",Object.create(null),0,8);let NodeSet=class NodeSet{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let r of this.types){let n=null;for(let t of e){let e=t(r);e&&(n||(n=Object.assign({},r.props)),n[e[0].id]=e[1])}t.push(n?new NodeType(r.name,n,r.id,r.flags):r)}return new NodeSet(t)}};let a=new WeakMap,h=new WeakMap;(s=n||(n={}))[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays";let Tree=class Tree{constructor(e,t,r,n,s){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,s&&s.length)for(let[e,t]of(this.props=Object.create(null),s))this.props["number"==typeof e?e:e.id]=t}toString(){let e=MountedTree.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let e of this.children){let r=e.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,t=0,r=0){let n=new TreeCursor(a.get(this)||this.topNode);return n.moveTo(e,t),a.set(this,n._tree),n}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,t=0){let r=f(a.get(this)||this.topNode,e,t,!1);return a.set(this,r),r}resolveInner(e,t=0){let r=f(h.get(this)||this.topNode,e,t,!0);return h.set(this,r),r}resolveStack(e,t=0){return function(e,t,r){let n=e.resolveInner(t,r),s=null;for(let e=n instanceof TreeNode?n:n.context.parent;e;e=e.parent)if(e.index<0){let i=e.parent;(s||(s=[n])).push(i.resolve(t,r)),e=i}else{let i=MountedTree.get(e.tree);if(i&&i.overlay&&i.overlay[0].from<=t&&i.overlay[i.overlay.length-1].to>=t){let o=new TreeNode(i.tree,i.overlay[0].from+e.from,-1,e);(s||(s=[n])).push(f(o,t,r,!1))}}return s?p(s):n}(this,e,t)}iterate(e){let{enter:t,leave:r,from:s=0,to:i=this.length}=e,o=e.mode||0,l=(o&n.IncludeAnonymous)>0;for(let e=this.cursor(o|n.IncludeAnonymous);;){let n=!1;if(e.from<=i&&e.to>=s&&(!l&&e.type.isAnonymous||!1!==t(e))){if(e.firstChild())continue;n=!0}for(;n&&r&&(l||!e.type.isAnonymous)&&r(e),!e.nextSibling();){if(!e.parent())return;n=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:b(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(e,t,r)=>new Tree(this.type,e,t,r,this.propValues),e.makeTree||((e,t,r)=>new Tree(NodeType.none,e,t,r)))}static build(e){return function(e){var t;let{buffer:r,nodeSet:n,maxBufferLength:s=i,reused:o=[],minRepeatType:l=n.types.length}=e,a=Array.isArray(r)?new FlatBufferCursor(r,r.length):r,h=n.types,u=0,f=0;function d(e,t,r,s,i,o,l,a,h){let u=[],f=[];for(;e.length>s;)u.push(e.pop()),f.push(t.pop()+r-i);e.push(c(n.types[l],u,f,o-i,a-o,h)),t.push(i-r)}function c(e,t,r,n,s,i,o){if(i){let e=[NodeProp.contextHash,i];o=o?[e].concat(o):[e]}if(s>25){let e=[NodeProp.lookAhead,s];o=o?[e].concat(o):[e]}return new Tree(e,t,r,n,o)}let p=[],g=[];for(;a.pos>0;)!function e(t,r,i,p,g,m){let{id:y,start:x,end:k,size:w}=a,v=f,N=u;for(;w<0;){if(a.next(),-1==w){let e=o[y];i.push(e),p.push(x-t);return}if(-3==w){u=y;return}if(-4==w){f=y;return}else throw RangeError(`Unrecognized record size: ${w}`)}let A=h[y],T,S,P=x-t;if(k-x<=s&&(S=function(e,t){let r=a.fork(),n=0,i=0,o=0,h=r.end-s,u={size:0,start:0,skip:0};e:for(let s=r.pos-e;r.pos>s;){let e=r.size;if(r.id==t&&e>=0){u.size=n,u.start=i,u.skip=o,o+=4,n+=4,r.next();continue}let a=r.pos-e;if(e<0||a<s||r.start<h)break;let f=4*(r.id>=l),d=r.start;for(r.next();r.pos>a;){if(r.size<0)if(-3==r.size)f+=4;else break e;else r.id>=l&&(f+=4);r.next()}i=d,n+=e,o+=f}return(t<0||n==e)&&(u.size=n,u.start=i,u.skip=o),u.size>4?u:void 0}(a.pos-r,g))){let e=new Uint16Array(S.size-S.skip),r=a.pos-S.size,s=e.length;for(;a.pos>r;)s=function e(t,r,n){let{id:s,start:i,end:o,size:h}=a;if(a.next(),h>=0&&s<l){let l=n;if(h>4){let s=a.pos-(h-4);for(;a.pos>s;)n=e(t,r,n)}r[--n]=l,r[--n]=o-t,r[--n]=i-t,r[--n]=s}else -3==h?u=s:-4==h&&(f=s);return n}(S.start,e,s);T=new TreeBuffer(e,k-S.start,n),P=S.start-t}else{let t=a.pos-w;a.next();let r=[],i=[],o=y>=l?y:-1,h=0,u=k;for(;a.pos>t;)o>=0&&a.id==o&&a.size>=0?(a.end<=u-s&&(d(r,i,x,h,a.end,u,o,v,N),h=r.length,u=a.end),a.next()):m>2500?function(e,t,r,i){let o=[],l=0,h=-1;for(;a.pos>t;){let{id:e,start:t,end:r,size:n}=a;if(n>4)a.next();else if(h>-1&&t<h)break;else h<0&&(h=r-s),o.push(e,t,r),l++,a.next()}if(l){let t=new Uint16Array(4*l),s=o[o.length-2];for(let e=o.length-3,r=0;e>=0;e-=3)t[r++]=o[e],t[r++]=o[e+1]-s,t[r++]=o[e+2]-s,t[r++]=r;r.push(new TreeBuffer(t,o[2]-s,n)),i.push(s-e)}}(x,t,r,i):e(x,t,r,i,o,m+1);if(o>=0&&h>0&&h<r.length&&d(r,i,x,h,x,u,o,v,N),r.reverse(),i.reverse(),o>-1&&h>0){let e=function(e,t){return(r,n,s)=>{let i=0,o=r.length-1,l,a;if(o>=0&&(l=r[o])instanceof Tree){if(!o&&l.type==e&&l.length==s)return l;(a=l.prop(NodeProp.lookAhead))&&(i=n[o]+l.length+a)}return c(e,r,n,s,i,t)}}(A,N);T=b(A,r,i,0,r.length,0,k-x,e,e)}else T=c(A,r,i,k-x,v-k,N)}i.push(T),p.push(P)}(e.start||0,e.bufferStart||0,p,g,-1,0);let m=null!=(t=e.length)?t:p.length?g[0]+p[0].length:0;return new Tree(h[e.topID],p.reverse(),g.reverse(),m)}(e)}};Tree.empty=new Tree(NodeType.none,[],[],0);let FlatBufferCursor=class FlatBufferCursor{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}};let TreeBuffer=class TreeBuffer{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return NodeType.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],s=n.name;if(/\W/.test(s)&&!n.isError&&(s=JSON.stringify(s)),r==(e+=4))return s;let i=[];for(;e<r;)i.push(this.childString(e)),e=this.buffer[e+3];return s+"("+i.join(",")+")"}findChild(e,t,r,n,s){let{buffer:i}=this,o=-1;for(let l=e;l!=t&&(!u(s,n,i[l+1],i[l+2])||(o=l,!(r>0)));l=i[l+3]);return o}slice(e,t,r){let n=this.buffer,s=new Uint16Array(t-e),i=0;for(let o=e,l=0;o<t;){s[l++]=n[o++],s[l++]=n[o++]-r;let t=s[l++]=n[o++]-r;s[l++]=n[o++]-e,i=Math.max(i,t)}return new TreeBuffer(s,i,this.set)}};function u(e,t,r,n){switch(e){case -2:return r<t;case -1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return!0}}function f(e,t,r,s){for(var i;e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t);){let t=!s&&e instanceof TreeNode&&e.index<0?null:e.parent;if(!t)return e;e=t}let o=s?0:n.IgnoreOverlays;if(s)for(let n=e,s=n.parent;s;s=(n=s).parent)n instanceof TreeNode&&n.index<0&&(null==(i=s.enter(t,r,o))?void 0:i.from)!=n.from&&(e=s);for(;;){let n=e.enter(t,r,o);if(!n)return e;e=n}}let BaseNode=class BaseNode{cursor(e=0){return new TreeCursor(this,e)}getChild(e,t=null,r=null){let n=d(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return d(this,e,t,r)}resolve(e,t=0){return f(this,e,t,!1)}resolveInner(e,t=0){return f(this,e,t,!0)}matchContext(e){return c(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let e=t.lastChild;if(!e||e.to!=t.to)break;e.type.isError&&e.from==e.to?(r=t,t=e.prevSibling):t=e}return r}get node(){return this}get next(){return this.parent}};let TreeNode=class TreeNode extends BaseNode{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,s,i=0){for(let o=this;;){for(let{children:l,positions:a}=o._tree,h=t>0?l.length:-1;e!=h;e+=t){let h=l[e],f=a[e]+o.from;if(u(s,r,f,f+h.length)){if(h instanceof TreeBuffer){if(i&n.ExcludeBuffers)continue;let l=h.findChild(0,h.buffer.length,t,r-f,s);if(l>-1)return new BufferNode(new BufferContext(o,h,e,f),null,l)}else if(i&n.IncludeAnonymous||!h.type.isAnonymous||g(h)){let l;if(!(i&n.IgnoreMounts)&&(l=MountedTree.get(h))&&!l.overlay)return new TreeNode(l.tree,f,e,o);let a=new TreeNode(h,f,e,o);return i&n.IncludeAnonymous||!a.type.isAnonymous?a:a.nextChild(t<0?h.children.length-1:0,t,r,s)}}}if(i&n.IncludeAnonymous||!o.type.isAnonymous||(e=o.index>=0?o.index+t:t<0?-1:o._parent._tree.children.length,!(o=o._parent)))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,r=0){let s;if(!(r&n.IgnoreOverlays)&&(s=MountedTree.get(this._tree))&&s.overlay){let r=e-this.from;for(let{from:e,to:n}of s.overlay)if((t>0?e<=r:e<r)&&(t<0?n>=r:n>r))return new TreeNode(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}};function d(e,t,r,n){let s=e.cursor(),i=[];if(!s.firstChild())return i;if(null!=r){for(let e=!1;!e;)if(e=s.type.is(r),!s.nextSibling())return i}for(;;){if(null!=n&&s.type.is(n))return i;if(s.type.is(t)&&i.push(s.node),!s.nextSibling())return null==n?i:[]}}function c(e,t,r=t.length-1){for(let n=e;r>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[r]&&t[r]!=n.name)return!1;r--}}return!0}let BufferContext=class BufferContext{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}};let BufferNode=class BufferNode extends BaseNode{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return s<0?null:new BufferNode(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,r=0){if(r&n.ExcludeBuffers)return null;let{buffer:s}=this.context,i=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return i<0?null:new BufferNode(this.context,this,i)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,s=r.buffer[this.index+3];if(s>n){let i=r.buffer[this.index+1];e.push(r.slice(n,s,i)),t.push(0)}return new Tree(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}};function p(e){if(!e.length)return null;let t=0,r=e[0];for(let n=1;n<e.length;n++){let s=e[n];(s.from>r.from||s.to<r.to)&&(r=s,t=n)}let n=r instanceof TreeNode&&r.index<0?null:r.parent,s=e.slice();return n?s[t]=n:s.splice(t,1),new StackIterator(s,r)}let StackIterator=class StackIterator{constructor(e,t){this.heads=e,this.node=t}get next(){return p(this.heads)}};let TreeCursor=class TreeCursor{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let t=e._parent;t;t=t._parent)this.stack.unshift(t.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return!!e&&(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0)}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return!!e&&(e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)))}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,s=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return!(s<0)&&(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?!(r&n.ExcludeBuffers)&&this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&n.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&n.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return!!this._tree._parent&&this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let e=r<0?0:this.stack[r]+4;if(this.index!=e)return this.yieldBuf(t.findChild(e,this.index,-1,0,4))}else{let e=t.buffer[this.index+3];if(e<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(e)}return r<0&&this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode))}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let e=0;e<this.index;e++)if(s.buffer.buffer[e+3]<this.index)return!1;({index:t,parent:r}=s)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let s=t+e,i=e<0?-1:r._tree.children.length;s!=i;s+=e){let e=r._tree.children[s];if(this.mode&n.IncludeAnonymous||e instanceof TreeBuffer||!e.type.isAnonymous||g(e))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,s=this.stack.length;s>=0;){for(let i=e;i;i=i._parent)if(i.index==n){if(n==this.index)return i;t=i,r=s+1;break e}n=this.stack[--s]}for(let e=r;e<this.stack.length;e++)t=new BufferNode(this.buffer,t,this.stack[e]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||!1!==e(this)){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return c(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,s=this.stack.length-1;n>=0;s--){if(s<0)return c(this._tree,e,n);let i=r[t.buffer[this.stack[s]]];if(!i.isAnonymous){if(e[n]&&e[n]!=i.name)return!1;n--}}return!0}};function g(e){return e.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||g(e))}let m=new WeakMap;function y(e,t){if(!e.isAnonymous||t instanceof TreeBuffer||t.type!=e)return 1;let r=m.get(t);if(null==r){for(let n of(r=1,t.children)){if(n.type!=e||!(n instanceof Tree)){r=1;break}r+=y(e,n)}m.set(t,r)}return r}function b(e,t,r,n,s,i,o,l,a){let h=0;for(let r=n;r<s;r++)h+=y(e,t[r]);let u=Math.ceil(1.5*h/8),f=[],d=[];return!function t(r,n,s,o,l){for(let h=s;h<o;){let s=h,c=n[h],p=y(e,r[h]);for(h++;h<o;h++){let t=y(e,r[h]);if(p+t>=u)break;p+=t}if(h==s+1){if(p>u){let e=r[s];t(e.children,e.positions,0,e.children.length,n[s]+l);continue}f.push(r[s])}else{let t=n[h-1]+r[h-1].length-c;f.push(b(e,r,n,s,h,c,t,null,a))}d.push(c+l-i)}}(t,r,n,s,0),(l||a)(f,d,o)}let NodeWeakMap=class NodeWeakMap{constructor(){this.map=new WeakMap}setBuffer(e,t,r){let n=this.map.get(e);n||this.map.set(e,n=new Map),n.set(t,r)}getBuffer(e,t){let r=this.map.get(e);return r&&r.get(t)}set(e,t){e instanceof BufferNode?this.setBuffer(e.context.buffer,e.index,t):e instanceof TreeNode&&this.map.set(e.tree,t)}get(e){return e instanceof BufferNode?this.getBuffer(e.context.buffer,e.index):e instanceof TreeNode?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}};let TreeFragment=class TreeFragment{constructor(e,t,r,n,s=!1,i=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=!!s|2*!!i}get openStart(){return(1&this.open)>0}get openEnd(){return(2&this.open)>0}static addTree(e,t=[],r=!1){let n=[new TreeFragment(0,e.length,e,0,!1,r)];for(let r of t)r.to>e.length&&n.push(r);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],s=1,i=e.length?e[0]:null;for(let o=0,l=0,a=0;;o++){let h=o<t.length?t[o]:null,u=h?h.fromA:1e9;if(u-l>=r)for(;i&&i.from<u;){let t=i;if(l>=t.from||u<=t.to||a){let e=Math.max(t.from,l)-a,r=Math.min(t.to,u)-a;t=e>=r?null:new TreeFragment(e,r,t.tree,t.offset+a,o>0,!!h)}if(t&&n.push(t),i.to>u)break;i=s<e.length?e[s++]:null}if(!h)break;l=h.toA,a=h.toA-h.toB}return n}};let Parser=class Parser{startParse(e,t,r){return"string"==typeof e&&(e=new StringInput(e)),r=r?r.length?r.map(e=>new Range(e.from,e.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let e=n.advance();if(e)return e}}};let StringInput=class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}};function x(e){return(t,r,n,s)=>new MixedParse(t,e,r,n,s)}let InnerParse=class InnerParse{constructor(e,t,r,n,s){this.parser=e,this.parse=t,this.overlay=r,this.target=n,this.from=s}};function k(e){if(!e.length||e.some(e=>e.from>=e.to))throw RangeError("Invalid inner parse ranges given: "+JSON.stringify(e))}let ActiveOverlay=class ActiveOverlay{constructor(e,t,r,n,s,i,o){this.parser=e,this.predicate=t,this.mounts=r,this.index=n,this.start=s,this.target=i,this.prev=o,this.depth=0,this.ranges=[]}};let w=new NodeProp({perNode:!0});let MixedParse=class MixedParse{constructor(e,t,r,n,s){this.nest=t,this.input=r,this.fragments=n,this.ranges=s,this.inner=[],this.innerDone=0,this.baseTree=null,this.stoppedAt=null,this.baseParse=e}advance(){if(this.baseParse){let e=this.baseParse.advance();if(!e)return null;if(this.baseParse=null,this.baseTree=e,this.startInner(),null!=this.stoppedAt)for(let e of this.inner)e.parse.stopAt(this.stoppedAt)}if(this.innerDone==this.inner.length){let e=this.baseTree;return null!=this.stoppedAt&&(e=new Tree(e.type,e.children,e.positions,e.length,e.propValues.concat([[w,this.stoppedAt]]))),e}let e=this.inner[this.innerDone],t=e.parse.advance();if(t){this.innerDone++;let r=Object.assign(Object.create(null),e.target.props);r[NodeProp.mounted.id]=new MountedTree(t,e.overlay,e.parser),e.target.props=r}return null}get parsedPos(){if(this.baseParse)return 0;let e=this.input.length;for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].from<e&&(e=Math.min(e,this.inner[t].parse.parsedPos));return e}stopAt(e){if(this.stoppedAt=e,this.baseParse)this.baseParse.stopAt(e);else for(let t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)}startInner(){let e=new FragmentCursor(this.fragments),t=null,r=null,s=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),n.IncludeAnonymous|n.IgnoreMounts);e:for(let n,i;;){let o=!0,l;if(null!=this.stoppedAt&&s.from>=this.stoppedAt)o=!1;else if(e.hasNode(s)){if(t){let e=t.mounts.find(e=>e.frag.from<=s.from&&e.frag.to>=s.to&&e.mount.overlay);if(e)for(let r of e.mount.overlay){let n=r.from+e.pos,i=r.to+e.pos;n>=s.from&&i<=s.to&&!t.ranges.some(e=>e.from<i&&e.to>n)&&t.ranges.push({from:n,to:i})}}o=!1}else if(r&&(i=function(e,t,r){for(let n of e){if(n.from>=r)break;if(n.to>t)return n.from<=t&&n.to>=r?2:1}return 0}(r.ranges,s.from,s.to)))o=2!=i;else if(!s.type.isAnonymous&&(n=this.nest(s,this.input))&&(s.from<s.to||!n.overlay)){s.tree||function(e){let{node:t}=e,r=[],n=t.context.buffer;do r.push(e.index),e.parent();while(!e.tree)let s=e.tree,i=s.children.indexOf(n),o=s.children[i],l=o.buffer,a=[i];for(let n of(s.children[i]=function e(n,s,i,h,u,f){let d=r[f],c=[],p=[];v(o,n,d,c,p,h);let g=l[d+1],m=l[d+2];a.push(c.length);let y=f?e(d+4,l[d+3],o.set.types[l[d]],g,m-g,f-1):t.toTree();return c.push(y),p.push(g-h),v(o,l[d+3],s,c,p,h),new Tree(i,c,p,u)}(0,l.length,NodeType.none,0,o.length,r.length-1),a)){let t=e.tree.children[n],r=e.tree.positions[n];e.yield(new TreeNode(t,r+e.from,n,e._tree))}}(s);let i=e.findMounts(s.from,n.parser);if("function"==typeof n.overlay)t=new ActiveOverlay(n.parser,n.overlay,i,this.inner.length,s.from,s.tree,t);else{let e=N(this.ranges,n.overlay||(s.from<s.to?[new Range(s.from,s.to)]:[]));e.length&&k(e),(e.length||!n.overlay)&&this.inner.push(new InnerParse(n.parser,e.length?n.parser.startParse(this.input,A(i,e),e):n.parser.startParse(""),n.overlay?n.overlay.map(e=>new Range(e.from-s.from,e.to-s.from)):null,s.tree,e.length?e[0].from:s.from)),n.overlay?e.length&&(r={ranges:e,depth:0,prev:r}):o=!1}}else if(t&&(l=t.predicate(s))&&(!0===l&&(l=new Range(s.from,s.to)),l.from<l.to)){let e=t.ranges.length-1;e>=0&&t.ranges[e].to==l.from?t.ranges[e]={from:t.ranges[e].from,to:l.to}:t.ranges.push(l)}if(o&&s.firstChild())t&&t.depth++,r&&r.depth++;else for(;!s.nextSibling();){if(!s.parent())break e;if(t&&!--t.depth){let e=N(this.ranges,t.ranges);e.length&&(k(e),this.inner.splice(t.index,0,new InnerParse(t.parser,t.parser.startParse(this.input,A(t.mounts,e),e),t.ranges.map(e=>new Range(e.from-t.start,e.to-t.start)),t.target,e[0].from))),t=t.prev}!r||--r.depth||(r=r.prev)}}}};function v(e,t,r,n,s,i){if(t<r){let o=e.buffer[t+1];n.push(e.slice(t,r,o)),s.push(o-i)}}let StructureCursor=class StructureCursor{constructor(e,t){this.offset=t,this.done=!1,this.cursor=e.cursor(n.IncludeAnonymous|n.IgnoreMounts)}moveTo(e){let{cursor:t}=this,r=e-this.offset;for(;!this.done&&t.from<r;)t.to>=e&&t.enter(r,1,n.IgnoreOverlays|n.ExcludeBuffers)||t.next(!1)||(this.done=!0)}hasNode(e){if(this.moveTo(e.from),!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree)for(let t=this.cursor.tree;;){if(t==e.tree)return!0;if(t.children.length&&0==t.positions[0]&&t.children[0]instanceof Tree)t=t.children[0];else break}return!1}};let FragmentCursor=class FragmentCursor{constructor(e){var t;if(this.fragments=e,this.curTo=0,this.fragI=0,e.length){let r=this.curFrag=e[0];this.curTo=null!=(t=r.tree.prop(w))?t:r.to,this.inner=new StructureCursor(r.tree,-r.offset)}else this.curFrag=this.inner=null}hasNode(e){for(;this.curFrag&&e.from>=this.curTo;)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)}nextFrag(){var e;if(this.fragI++,this.fragI==this.fragments.length)this.curFrag=this.inner=null;else{let t=this.curFrag=this.fragments[this.fragI];this.curTo=null!=(e=t.tree.prop(w))?e:t.to,this.inner=new StructureCursor(t.tree,-t.offset)}}findMounts(e,t){var r;let n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(let e=this.inner.cursor.node;e;e=e.parent){let s=null==(r=e.tree)?void 0:r.prop(NodeProp.mounted);if(s&&s.parser==t)for(let t=this.fragI;t<this.fragments.length;t++){let r=this.fragments[t];if(r.from>=e.to)break;r.tree==this.curFrag.tree&&n.push({frag:r,pos:e.from-r.offset,mount:s})}}}return n}};function N(e,t){let r=null,n=t;for(let s=1,i=0;s<e.length;s++){let o=e[s-1].to,l=e[s].from;for(;i<n.length;i++){let e=n[i];if(e.from>=l)break;!(e.to<=o)&&(r||(n=r=t.slice()),e.from<o?(r[i]=new Range(e.from,o),e.to>l&&r.splice(i+1,0,new Range(l,e.to))):e.to>l?r[i--]=new Range(l,e.to):r.splice(i--,1))}}return n}function A(e,t){let r=[];for(let{pos:n,mount:s,frag:i}of e){let e=n+(s.overlay?s.overlay[0].from:0),o=e+s.tree.length,l=Math.max(i.from,e),a=Math.min(i.to,o);if(s.overlay){let o=function(e,t,r,n){let s=0,i=0,o=!1,l=!1,a=-1e9,h=[];for(;;){let u=s==e.length?1e9:o?e[s].to:e[s].from,f=i==t.length?1e9:l?t[i].to:t[i].from;if(o!=l){let e=Math.max(a,r),t=Math.min(u,f,n);e<t&&h.push(new Range(e,t))}if(1e9==(a=Math.min(u,f)))break;u==a&&(o?(o=!1,s++):o=!0),f==a&&(l?(l=!1,i++):l=!0)}return h}(t,s.overlay.map(e=>new Range(e.from+n,e.to+n)),l,a);for(let t=0,n=l;;t++){let l=t==o.length,h=l?a:o[t].from;if(h>n&&r.push(new TreeFragment(n,h,s.tree,-e,i.from>=n||i.openStart,i.to<=h||i.openEnd)),l)break;n=o[t].to}}else r.push(new TreeFragment(l,a,s.tree,-e,i.from>=e||i.openStart,i.to<=o||i.openEnd))}return r}}}]);
//# sourceMappingURL=15874-ef733e572161.js.map